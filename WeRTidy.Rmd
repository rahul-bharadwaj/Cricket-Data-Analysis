---
title: "WeRTidy"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
knitr::opts_chunk$set(fig.cap = "", fig.path = "Plot")
```

```{r Libraries, warning=FALSE, echo=FALSE}
library(tidyverse)
library(ggpubr)
library(ggplot2)
library(plotly)
library(knitr)
library(gridExtra)
library(kableExtra)
library(cricketdata)
```

# Introduction
This report aims at deducing the quality of batsmen in cricket from around the globe. The data used for this purpose is downloaded from the R package "cricketdata" from the following link - [Cricket Data Source.](https://docs.ropensci.org/cricketdata/) Data on all international cricket matches is provided by ESPNCricinfo. This package provides some scraper functions to download the data into tibbles ready for analysis. For the purpose of the assignment, this data is trimmed to suit our needs and consists of only 5 variables and 500 observations.

We can install cricketdata from github with:
```{r GitHubData, eval=FALSE, warning=FALSE}
install.packages("devtools")
devtools::install_github("ropenscilabs/cricketdata")
```

We are looking at only a subset of this data using the following lines of code:
```{r Data, cache=TRUE, warning=FALSE}
cric_bat_data <- fetch_cricinfo("ODI", "Men", "Batting", "Career") %>% select(-Country)
cric_bowl_data <- fetch_cricinfo("ODI", "Men", "Bowling", "Career") %>% select(-Country)
cric_field_data <- fetch_cricinfo("ODI", "Men", "Fielding", "Career") %>% select(-Country)
```

Once this data has been processed into a Comma Seperated Value file (csv), the rows and columns are trimmed according to the needs of the analysis.

The concise data is read from the csv file as follows -
```{r Tidying}
field_data_tidy <- separate(cric_field_data,
                            col = "Player",
                            into = c("Player", "Region"),
                            sep = "[*(*]"
)

bowl_data_tidy <- separate(cric_bowl_data,
                            col = "Player",
                            into = c("Player", "Region"),
                            sep = "[*(*]"
)

bat_data_tidy <- separate(cric_bat_data,
                            col = "Player",
                            into = c("Player", "Region"),
                            sep = "[*(*]"
)

bat_data <- bat_data_tidy %>% select(-Region)
bowl_data <- bowl_data_tidy %>% select(-Region)
field_data <- field_data_tidy %>% select(-Region)
field_data
```
```{r WriteCSV}
write.csv(bat_data, file = "Batting.csv")
write.csv(bowl_data, file = "Bowling.csv")
write.csv(field_data, file = "Fielding.csv")
```









```{r CalculateBat}
top_bat_data <- bat_data %>%
   mutate(Batting_Quality = (Runs/BallsFaced) * Innings,
          diff = Batting_Quality-Innings,
           Player=as.character(Player)) %>% 

  arrange(desc(diff)) %>%
  
  drop_na() %>% head(500) %>%
  rename(Batting_Average=Average,
         Batting_Strikerate=StrikeRate)

plot_bat <-  top_bat_data %>% 
  ggplot(aes(x=diff,y=Player)) + 
  geom_point()+ 
  geom_vline(xintercept = 0, color = "red")
  ggplotly(plot_bat)
```



```{r CalculateBowl}
top_bowl_data <- bowl_data %>%
  mutate(efficiency = Wickets/Innings,
         Player = as.character(Player))  %>%
  head(500) %>% rename(Bowling_Average=Average,
                       Bowling_Strikerate=StrikeRate)
                        
plot_bowl <- top_bowl_data %>% 
  ggplot(aes(x=efficiency,y=Player))+
  geom_point()+
  geom_vline(xintercept = 1,color="red")  
  ggplotly(plot_bowl)
```


```{r CalculateField}
top_field_data <- field_data %>% 
  mutate(overall_fielder=Dismissals/Innings,
         wicketkeeper=(Stumped+CaughtBehind)/Innings,
         Player=as.character(Player)) %>% 
  head(500)

plot_field <- top_field_data %>% 
  ggplot(aes(x=overall_fielder,y=Player))+
  geom_point()+
  geom_vline(xintercept = 1,color="red")  
  ggplotly(plot_field)
  
 plot_wk <- top_field_data %>% 
  ggplot(aes(x=wicketkeeper,y=Player))+
  geom_point()+
  geom_vline(xintercept = 1,color="red")  
  ggplotly(plot_wk)
```


```{r}
##join
bat_bowl <- top_bat_data %>%
  inner_join(top_bowl_data, by = "Player") %>% 
  select(Player, efficiency, diff, Batting_Quality)

plot_batbowl <- bat_bowl %>% 
  ggplot(aes(y=diff,x=efficiency,color=Player))+
  geom_point()+geom_vline(xintercept = 0, color="red") + theme(legend.position = "none")

ggplotly(plot_batbowl)
```



